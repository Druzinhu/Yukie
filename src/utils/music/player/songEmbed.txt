const Discord = require('discord.js');

module.exports = async function songEmbed(message, queue, song) {
  //if (song.seconds < 15) song.embed = { repeat: true };
  //else song.embed = { repeat: false };
  if (song.loop) {
    if (song.message.deleted) {
      song.message = await message.channel.send('**ðŸŽ§ Tocando agora:**', createEmbed());
      song.message.react('ðŸ’œ');
    }
    /*const embed = (await queue.songEmbed).embeds[0];
    const description = embed.description.split(' â€¢ ');
    console.log(description)
    const duration = description[1].split('DuraÃ§Ã£o ')[1];

    if (embed.title !== song.title || description[0] !== message.author.toString() || duration !== song.duration) {
      if (song.seconds < 15) {
        song.message = (await queue.songEmbed).edit(createEmbed())
        song.message.then(m => console.log(m))
      }
    }*/
  } else {
    song.message = await message.channel.send('**ðŸŽ§ Tocando agora:**', createEmbed());
    song.message.react('ðŸ’œ');
    song.loop = true;
  }

  function createEmbed() {
    const embed = new Discord.MessageEmbed()
    .setTitle(`${song.title}`)
    .setDescription(`${song.author} â€¢ DuraÃ§Ã£o ${song.duration}`)
    .setThumbnail(song.thumbnail)
    .setColor(process.env.DEFAULT_COLOR);
    return embed;
  }

  return song.message;
  //message.channel.send('**ðŸŽ§ Tocando agora:**', embed)//.then(m => m.react('ðŸ’œ'));
}